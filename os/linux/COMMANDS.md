# Linux Commands

## ファイル／ディレクトリ操作

* `cd (パス)`
    * 指定したパスに移動する
* `dirname (パス)`
    * パスからディレクトリ名を取り出す
* `mkdir (ディレクトリ名)`
    * ディレクトリを作成する
* `cp -r (パス1) (パス2)`
    * パス1をパス2にコピーする
* `mv (パス1) (パス2)`
    * パス1をパス2に移動する
* `rm -rf (ファイル名 or ディレクトリ名)`
    * 指定したファイルまたはディレクトリを強制削除する
* `ln -sfn (リンク先) (シンボリックリンク名)`
    * シンボリックリンクの作成場所がディレクトリでも強制的にシンボリックリンクを作成する
* `mktemp`
    * 一時ファイルを安全に作成する

## 検索／表示

* `ls`
    * カレントディレクトリ直下のファイルやディレクトリを一覧表示する
* `ls -ltra`
    * カレントディレクトリ直下のファイルやディレクトリを一覧表示する（詳細表示、更新日時の降順、隠しファイル表示）
* `pwd`
    * カレントディレクトリを出力する
    * `-W`オプションでWindows形式のパスを表示する（Windows環境限定）
* `cygpath (パス)`
    * パスを変換する（Windows環境限定）
    * `-u`: Windows形式のパスをUnix形式に変換
    * `-d`: Unix形式のパスをWindows形式に変換
* `find . -type f -iname "(検索文字列)"`
    * カレントディレクトリ以下のファイルを大文字小文字無視で検索する
* `find -maxdepth`
    * 検索する階層の深さを指定する
* `find . -name .git -prune -o -print`
    * カレントディレクトリ以下の`.git`以外のファイル・ディレクトリを検索する
* `grep (検索文字列) (ファイル名)`
    * ファイルを検索文字列で検索する
* `(コマンド) | grep (検索文字列)`
    * コマンド結果を検索文字列で検索する
* `grep -i`
    * 大文字小文字を無視する
* `grep -v`
    * マッチしないものを出力する
* `grep -E`
    * 拡張正規表現を使う
* `rg (検索文字列)`
    * ファイルを検索文字列で検索する（ripgrep）
    * デフォルトで正規表現が使える
* `rg -i`
    * 大文字小文字を無視する
* `rg -v`
    * マッチしないものを出力する
* `rg -g (globパターン) (検索文字列)`
    * 特定のパターンに一致するファイルのみを検索対象にする
    * `*.txt`: txtファイルのみ
    * `!*.txt`: txtファイル以外
    * `src/**`: srcディレクトリ以下すべて
    * `!dist/**`: distディレクトリ以下を除外
* `cat (ファイル名)`
    * 指定したファイルの内容を出力する
* `less (ファイル名)`
    * 指定したファイルを閲覧する
* `view (ファイル名)`
    * 指定したファイルをviのモードで開く
* `tail -fn 0 (ファイル名)`
    * 指定したファイルの追記を監視する
* `wc (ファイル名)`
    * ファイルの行数、単語数、バイト数を表示する
* `wc -l (ファイル名)`
    * ファイルの行数を表示する
* `file (ファイル名)`
    * ファイルの詳細を確認できる
* `open (ファイル名またはURL)`
    * ファイルまたはURLを既定のアプリケーションで開く

## ファイル作成／編集

* `touch (ファイル名)`
    * ファイルを作成する
* `(コマンド) | tee (ファイル名)`
    * コマンドの実行結果を標準出力とファイルの両方に出力する
* `vi (ファイル名)`
    * 指定したファイルをviで開く
* `nano -v`
    * 読み取り専用モードで開く
* `sed -i 's/(置換前)/(置換後)/g' (ファイル名)`
    * 指定したファイルの中身を置換する
    * `()`で囲んだ部分をキャプチャグループといい、マッチした箇所を再利用可能にする
    * キャプチャグループを再利用するには`\1`のように参照する

## テキスト処理

* `(コマンド) | awk '{ print $n }'`
    * コマンド結果のn番目のフィールドを出力する（`$0`はレコード全体）
* `(コマンドA) | xargs (コマンドB)`
    * コマンドAの実行結果を1つずつ引数に渡し、コマンドBを実行する
* `(コマンドA) | xargs -I {} (コマンドB {})`
    * コマンドAの実行結果を`{}`の位置に渡してコマンドBを実行する

## 比較

* `test -f (ファイル)`
    * ファイルの存在確認
* `test -d (ディレクトリ)`
    * ディレクトリの存在確認
* `test -n (文字列)`
    * 文字列の長さが0でないことを確認
* `test -z (文字列)`
    * 文字列の長さが0であることを確認
* `test (数値1) -gt (数値2)`
    * 数値1が数値2より大きいことを確認
* `test (数値1) -lt (数値2)`
    * 数値1が数値2より小さいことを確認

## マニュアル

* `man (コマンド)`
    * コマンドのマニュアルを表示する
* `man -w (コマンド)`
    * マニュアルファイルのパスを表示する

## アーカイブ／圧縮

* `tar cavf hoge.tgz hoge/`
    * アーカイブを作成する（create, auto compress, verbose, file）
* `tar cavf hoge.tgz -C /fuga hoge/`
    * `/fuga`ディレクトリに移動してから`hoge/`を圧縮する
* `tar xvf hoge.tgz`
    * アーカイブを展開する（extract, verbose, file）
* `unzip (ファイル名).zip`
    * zipファイルを展開する

## 権限管理

* `sudo (コマンド)`
    * スーパーユーザー権限でコマンドを実行する
* `su - (ユーザー名)`
    * 指定したユーザーに変更し、ログインシェル環境を読み込む（`-`はログインシェルとして起動するオプション）
    * ユーザー名を省略した場合はrootとしてログインする
* `sudo su -`
    * sudo権限でsuコマンドを実行してrootになる（sudoers設定でパスワード入力が不要な場合は、パスワード入力なしでrootになれる）
* `EDITOR=vi visudo`
    * viでvisudoを実行する
* `whoami`
    * 現在のユーザーを出力する
* `id (ユーザー名)`
    * ユーザーの情報を表示する
* `groups (ユーザー名)`
    * 所属しているグループ一覧を表示する
* `getent group`
    * グループ一覧を表示する
* `passwd`
    * 現在のユーザーのパスワードを変更する
* `passwd (ユーザー名)`
    * 指定したユーザーのパスワードを変更する（root権限が必要）
* `usermod -aG sudo (ユーザー名)`
    * sudoグループにユーザーを追加する
* `chmod 755 (ファイル名またはディレクトリ名)`
    * ファイルまたはディレクトリの権限を変更する
    * ディレクトリには755、ファイルには644を付けることが多い
    * 755: 所有者に全ての権限、それ以外に読み取りと実行の権限を与える
    * 644: 所有者に読み取りと書き込みの権限、それ以外に読み取りの権限を与える
* `chown (所有者)(:所有グループ) (ファイル名またはディレクトリ名)`
    * ファイルまたはディレクトリの所有者、所有グループを設定する

## リモート接続

* `ssh-keygen -t ed25519 -C "hoge@example.com"`
    * `ed25519`アルゴリズムでSSH鍵を作成する
* `ssh (ユーザー名)@(ホスト名)`
    * SSH接続する
* `ssh -i (秘密鍵のパス) (ユーザー名)@(ホスト名)`
    * 秘密鍵を使ってSSH接続する
* `scp (ユーザー名)@(ホスト名):(コピー元) (コピー先)`
    * ファイルをダウンロードする
* `scp -i (秘密鍵のパス) (コピー元) (ユーザー名)@(ホスト名):(コピー先)`
    * 秘密鍵を使いファイルをアップロードする
* `scp -r (コピー元ディレクトリ) (ユーザー名)@(ホスト名):(コピー先ディレクトリ)`
    * ディレクトリをアップロードする

## プロセス／リソース管理

* `ps aux`
    * プロセス一覧を表示
* `top`
    * プロセスの状態をリアルタイムで表示する
    * `f`でソートキーを切り替えたり、カラムの表示／非表示を切り替えられる
    * `R`でソートを反転する
    * 互換性のために残っているコマンドの一例（ヘルプに表示されない）
        * `M`: ソートキーをメモリに変更
        * `N`: ソートキーをPIDに変更
        * `P`: ソートキーをCPUに変更
* `kill (PID)`
    * プロセスを停止
    * `-3`: Javaではスレッドダンプを出力 (SIGQUIT)
    * `-l`: 送信可能なシグナル一覧を表示
* `lsof -Pan -i :(ポート番号)`
    * 指定したポート番号を使っているプロセスを特定する
    * `-P`: ポート番号を数値で表示、`-a`: AND条件、`-n`: ホスト名を数値で表示、`-i`: ネットワークファイルを選択
* `lsof -Pan -p (プロセス番号) -i`
    * プロセスIDからポート番号を特定する
    * `-P`: ポート番号を数値で表示、`-a`: AND条件、`-n`: ホスト名を数値で表示、`-p`: プロセスIDを指定、`-i`: ネットワークファイルを選択
* `df -h`
    * ディスク状態を確認する
* `du -sh`
    * ディレクトリ全体のサイズの確認
* `free -h`
    * メモリの使用状況を確認する
* `uptime -s`
    * 最後に起動した時間を調べる

## システム情報

* `date`
    * 現在日時を表示する
* `uname -m`
    * アーキテクチャを表示する
* `hostname`
    * ホスト名を表示する
* `hostname -i`
    * IPアドレスを表示する
* `type (コマンド)`
    * 指定したコマンドについて表示する（コマンドの場所など）

## デーモン管理

* `systemctl daemon-reload`
    * systemdのデーモン設定を再読み込みする
* `systemctl enable (サービス名)`
    * 指定したサービスを自動起動するように設定する
* `systemctl status (サービス名)`
    * サービスの状態を確認する
* `systemctl list-unit-files --type=service --state=enabled`
    * 自動起動設定済みのサービス一覧

## ネットワーク

* `wget (リンク)`
    * リンク先をダウンロードする
* `wget -O (ファイル名) (リンク)`
    * リンク先を名前を付けて保存する
* `curl -LO (URL)`
    * リダイレクトに従い（-L）、URLのファイル名で保存する（-O）
* `firewall-cmd --permanent --add-port=8080/tcp`
    * ファイアウォールのポート8080/tcpを永続的に開放する
* `firewall-cmd --permanent --remove-port=8080/tcp`
    * ファイアウォールのポート8080/tcpを永続的に削除する
* `firewall-cmd --reload`
    * ファイアウォールの設定を再読み込みする
* `firewall-cmd --list-ports`
    * 開放されているポートの一覧を表示する

## フォント管理

* `fc-cache -v`
    * フォントキャッシュを更新する（verbose）
* `fc-list`
    * インストールされているフォントを一覧表示する

## シェル

* `sh (シェルスクリプト名)`
    * 指定したシェルスクリプトを実行する
* `chsh -s /bin/bash (ユーザー名)`
    * ユーザーのログインシェルを変更する
* `set -o`
    * シェルオプションの一覧を表示する

## シャットダウン／再起動

* `shutdown -h now`
    * すぐにシャットダウンする
* `reboot`
    * すぐに再起動する

## パッケージマネージャ（apt）

### aptコマンド

* `apt update`
    * パッケージリストを更新する
* `apt upgrade`
    * インストール済みパッケージを更新する
* `apt install (パッケージ名)`
    * パッケージをインストールする
* `apt remove (パッケージ名)`
    * パッケージを削除する（設定ファイルは残る）
* `apt purge (パッケージ名)`
    * パッケージと設定ファイルを完全に削除する
* `apt autoremove`
    * 自動インストールとマークされているもののうち、どのパッケージからも依存されていないものを削除する
* `apt autoremove --dry-run`
    * 削除されるパッケージを実際に削除せずに確認する
* `apt list --installed`
    * インストール済みパッケージ一覧を表示する
* `apt list --upgradable`
    * アップグレード可能なパッケージ一覧を表示する
* `apt search (パッケージ名)`
    * パッケージを検索する
* `apt show (パッケージ名)`
    * パッケージの詳細情報を表示する

### apt-cacheコマンド

* `apt-cache show (パッケージ名)`
    * パッケージの詳細情報を表示する
* `apt-cache search --names-only "(パッケージ名)"`
    * パッケージ名のみを対象に検索する
* `apt-cache depends (パッケージ名)`
    * パッケージの依存関係を表示する
* `apt-cache rdepends (パッケージ名)`
    * パッケージの逆依存関係を表示する（このパッケージに依存しているパッケージを表示）
* `apt-cache policy`
    * ポリシー設定情報を表示する、アクセスできるリポジトリの一覧を表示する

### apt-markコマンド

* `apt-mark showmanual`
    * 手動インストールとマークされているパッケージ一覧を表示する

### dpkgコマンド

* `dpkg -l`
    * インストール済みパッケージ一覧を表示する
* `dpkg -S (ファイル名)`
    * 指定したファイルがどのパッケージに含まれるかを表示する

### apt, apt-get, apt-cacheの違い

* apt: ユーザーフレンドリーなコマンド。プログレスバー表示、カラー出力などの機能がある
* apt-get: スクリプトでの使用に適した従来のコマンド。安定したインターフェース
* apt-cache: パッケージキャッシュの検索や情報表示に特化したコマンド

## パッケージマネージャ（pacman）

Arch Linuxやその派生ディストリビューションで使用されるパッケージマネージャ。

* `pacman -Ss (パッケージ)`
    * パッケージを検索する
* `pacman -Si (パッケージ)`
    * パッケージの情報を表示する
* `pacman -S (パッケージ)`
    * パッケージをインストールする
* `pacman -Syu`
    * システム全体をアップデートする
* `pacman -Rs (パッケージ)`
    * パッケージを依存関係も含めて削除する

## 算術式評価／算術式展開

* `$((式))`
    * 算術式を展開する
* `((式))`
    * 算術式を評価する

## リダイレクト

* `(コマンド) < (ファイル)`
    * ファイルの内容をコマンドの標準入力に渡す
* `(コマンド) > (ファイル)`
    * コマンドの標準出力をファイルに書き込む（上書き）
* `(コマンド) >> (ファイル)`
    * コマンドの標準出力をファイルに追記する
* `(コマンド) 2> (ファイル)`
    * コマンドの標準エラー出力をファイルに書き込む
* `(コマンド) &> (ファイル)`
    * コマンドの標準出力と標準エラー出力をファイルに書き込む
* `(コマンド) > (ファイル) 2>&1`
    * コマンドの標準出力と標準エラー出力をファイルに書き込む（`&>`と同じ）
* `(コマンド) &>> (ファイル)`
    * コマンドの標準出力と標準エラー出力をファイルに追記する
* `(コマンド) >> (ファイル) 2>&1`
    * コマンドの標準出力と標準エラー出力をファイルに追記する（`&>>`と同じ）

## パイプライン

* `(コマンドA) | (コマンドB)`
    * コマンドAの標準出力をコマンドBの標準入力に渡す
* `(コマンドA) |& (コマンドB)`
    * コマンドAの標準出力と標準エラー出力をコマンドBの標準入力に渡す
* `(コマンドA) 2>&1 | (コマンドB)`
    * コマンドAの標準出力と標準エラー出力をコマンドBの標準入力に渡す（`|&`と同じ）

## プロセス置換

* `<()`
    * コマンドの標準出力を読み込み用ファイルとして扱う
* `>()`
    * コマンドの標準入力を書き込み用ファイルとして扱う
* `diff <(コマンドA) <(コマンドB)`
    * コマンドAとコマンドBの出力を比較する
* `コマンドA > >(tee out.txt) 2> >(tee err.txt)`
    * 標準出力と標準エラー出力を別のファイルに書き込みながら画面へ表示する

## 組み込みコマンド

* `help`
    * 組み込みコマンドの一覧を表示する
* `help (コマンド)`
    * 組み込みコマンドのヘルプを表示する

## キーバインド

* `bind -P`
    * キーバインドの一覧を表示する
* `<C-w>`
    * カーソル位置から直前の単語の先頭まで削除する
* `<C-f>`, `<RIGHT>`
    * カーソルを1文字右に移動する
* `<C-b>`, `<LEFT>`
    * カーソルを1文字左に移動する
* `<ESC>f`, `<C-RIGHT>`
    * カーソルを次の単語の先頭に移動する
* `<ESC>b`, `<C-LEFT>`
    * カーソルを前の単語の先頭に移動する
* `<C-a>`, `<HOME>`
    * カーソルを行頭に移動する
* `<C-e>`, `<END>`
    * カーソルを行末に移動する
* `<C-n>`
    * 次のコマンド履歴を表示する
* `<C-p>`
    * 前のコマンド履歴を表示する
* `<C-r>`
    * コマンド履歴を検索する
* `<TAB>`
    * コマンドやファイル名を補完する

